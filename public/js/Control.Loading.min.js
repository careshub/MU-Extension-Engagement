(function(){function t(t){t.Control.Loading=t.Control.extend({options:{delayIndicator:null,position:"topleft",separate:!1,zoomControl:null,spinjs:!1,spin:{lines:7,length:3,width:3,radius:5,rotate:13,top:"83%"}},initialize:function(n){t.setOptions(this,n);this._dataLoaders={};this.options.zoomControl!==null&&(this.zoomControl=this.options.zoomControl)},onAdd:function(i){if(this.options.spinjs&&typeof Spinner!="function")return n.error("Leaflet.loading cannot load because you didn't load spin.js (http://fgnass.github.io/spin.js/), even though you set it in options.");this._addLayerListeners(i);this._addMapListeners(i);this.options.separate||this.zoomControl||(i.zoomControl?this.zoomControl=i.zoomControl:i.zoomsliderControl&&(this.zoomControl=i.zoomsliderControl));var u="leaflet-control-loading",r;return this.zoomControl&&!this.options.separate?(r=this.zoomControl._container,u+=" leaflet-bar-part-bottom leaflet-bar-part last",t.DomUtil.addClass(this._getLastControlButton(),"leaflet-bar-part-bottom")):r=t.DomUtil.create("div","leaflet-control-zoom leaflet-control-layer-container leaflet-bar"),this._indicatorContainer=r,this._indicator=t.DomUtil.create("a",u,r),this.options.spinjs&&(this._spinner=new Spinner(this.options.spin).spin(),this._indicator.appendChild(this._spinner.el)),r},onRemove:function(n){this._removeLayerListeners(n);this._removeMapListeners(n)},removeFrom:function(n){if(this.zoomControl&&!this.options.separate){this._container.removeChild(this._indicator);this._map=null;this.onRemove(n);return this}return t.Control.prototype.removeFrom.call(this,n)},addLoader:function(n){if(this._dataLoaders[n]=!0,this.options.delayIndicator&&!this.delayIndicatorTimeout){var t=this;this.delayIndicatorTimeout=setTimeout(function(){t.updateIndicator();t.delayIndicatorTimeout=null},this.options.delayIndicator)}else this.updateIndicator()},removeLoader:function(n){delete this._dataLoaders[n];this.updateIndicator();this.options.delayIndicator&&this.delayIndicatorTimeout&&!this.isLoading()&&(clearTimeout(this.delayIndicatorTimeout),this.delayIndicatorTimeout=null)},updateIndicator:function(){this.isLoading()?this._showIndicator():this._hideIndicator()},isLoading:function(){return this._countLoaders()>0},_countLoaders:function(){var n=0;for(var t in this._dataLoaders)this._dataLoaders.hasOwnProperty(t)&&n++;return n},_showIndicator:function(){t.DomUtil.addClass(this._indicator,"is-loading");t.DomUtil.addClass(this._indicatorContainer,"is-loading");this.options.separate||(this.zoomControl instanceof t.Control.Zoom?t.DomUtil.removeClass(this._getLastControlButton(),"leaflet-bar-part-bottom"):typeof t.Control.Zoomslider=="function"&&this.zoomControl instanceof t.Control.Zoomslider&&t.DomUtil.removeClass(this.zoomControl._ui.zoomOut,"leaflet-bar-part-bottom"))},_hideIndicator:function(){t.DomUtil.removeClass(this._indicator,"is-loading");t.DomUtil.removeClass(this._indicatorContainer,"is-loading");this.options.separate||(this.zoomControl instanceof t.Control.Zoom?t.DomUtil.addClass(this._getLastControlButton(),"leaflet-bar-part-bottom"):typeof t.Control.Zoomslider=="function"&&this.zoomControl instanceof t.Control.Zoomslider&&t.DomUtil.addClass(this.zoomControl._ui.zoomOut,"leaflet-bar-part-bottom"))},_getLastControlButton:function(){for(var i=this.zoomControl._container,n=i.children.length-1,t;n>0;){if(t=i.children[n],!(this._indicator===t||t.offsetWidth===0||t.offsetHeight===0))break;n--}return i.children[n]},_handleLoading:function(n){this.addLoader(this.getEventId(n))},_handleBaseLayerChange:function(n){var i=this;n.layer&&n.layer.eachLayer&&typeof n.layer.eachLayer=="function"?n.layer.eachLayer(function(n){i._handleBaseLayerChange({layer:n})}):t.TileLayer.Canvas&&n.layer instanceof t.TileLayer.Canvas||i._handleLoading(n)},_handleLoad:function(n){this.removeLoader(this.getEventId(n))},getEventId:function(n){return n.id?n.id:n.layer?n.layer._leaflet_id:n.target._leaflet_id},_layerAdd:function(t){if(t.layer&&t.layer.on)try{t.layer.on({loading:this._handleLoading,load:this._handleLoad},this)}catch(i){n.warn("L.Control.Loading: Tried and failed to add  event handlers to layer",t.layer);n.warn("L.Control.Loading: Full details",i)}},_layerRemove:function(t){if(t.layer&&t.layer.off)try{t.layer.off({loading:this._handleLoading,load:this._handleLoad},this)}catch(i){n.warn("L.Control.Loading: Tried and failed to remove event handlers from layer",t.layer);n.warn("L.Control.Loading: Full details",i)}},_addLayerListeners:function(n){n.eachLayer(function(n){if(n.on)n.on({loading:this._handleLoading,load:this._handleLoad},this)},this);n.on("layeradd",this._layerAdd,this);n.on("layerremove",this._layerRemove,this)},_removeLayerListeners:function(n){n.eachLayer(function(n){n.off&&n.off({loading:this._handleLoading,load:this._handleLoad},this)},this);n.off("layeradd",this._layerAdd,this);n.off("layerremove",this._layerRemove,this)},_addMapListeners:function(n){n.on({baselayerchange:this._handleBaseLayerChange,dataloading:this._handleLoading,dataload:this._handleLoad,layerremove:this._handleLoad},this)},_removeMapListeners:function(n){n.off({baselayerchange:this._handleBaseLayerChange,dataloading:this._handleLoading,dataload:this._handleLoad,layerremove:this._handleLoad},this)}});t.Map.addInitHook(function(){this.options.loadingControl&&(this.loadingControl=new t.Control.Loading,this.addControl(this.loadingControl))});t.Control.loading=function(n){return new t.Control.Loading(n)}}var n=window.console||{error:function(){},warn:function(){}};typeof define=="function"&&define.amd?define(["leaflet"],function(n){t(n)}):t(L)})();
//# sourceMappingURL=Control.Loading.min.js.map
